{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack:///./src/taskpane/outlook.js?"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\nconst NOTFOUNDYET = 0;\nconst POSITIVEMATCH = 1;\nconst NEGATIVEMATCH = 2;\n\nconst toAddress = \"bad@mail.com\";\n\nconst positiveMatch = \"no suspicious activity has been detected\";\nconst defaultSubject = \"Suspicious Email Alert\";\n\nvar itemIdRegex = /\\{\\%\\%(.+)\\%\\%\\}/;\nvar timeout = false;\nvar timeoutSet = false;\nvar result = NOTFOUNDYET;\nvar dataMap = [];\n\n/* global document, Office */\n\nOffice.onReady((info) => {\n  if (info.host === Office.HostType.Outlook) {\n    document.getElementById(\"mail-subject\").innerHTML =\n      stripHTML(Office.context.mailbox.item.subject);\n    document.getElementById(\"app-body\").style.display = \"flex\";\n    document.getElementById(\"run\").onclick = run;\n    document.getElementById(\"update\").onclick = update;\n    // load and start spinner\n    var spinnerElements = document.querySelectorAll(\".ms-Spinner\");\n    for (var i = 0; i < spinnerElements.length; i++) {\n      new fabric['Spinner'](spinnerElements[i]);\n    }\n    // message banner\n    var messageBanner = document.getElementById(\"messageBanner\");\n    var messageBannerCloseButton = messageBanner.querySelector('.ms-MessageBanner-close');\n\n    messageBannerCloseButton.addEventListener(\"click\", () => {\n      setTimeout(() => {\n        messageBanner.style.display = \"none\";\n      }, 500);\n    });\n    // clean up inbox with old reports\n    searchFolderForResults(\n      \"inbox\",\n      'from:\"' + toAddress + '\" AND received:today',\n      itemId => moveItemToDeleted(itemId),\n    );\n  }\n});\n\nfunction stripHTML(html) {\n  var div = document.createElement(\"div\");\n  div.innerHTML = html;\n  return div.textContent || div.innerText || \"\";\n}\n\nfunction errorCB(msg) {\n  disableSpinner();\n  // display user message\n  var messageBanner = document.getElementById(\"messageBanner\");\n  var clipper = messageBanner.querySelector(\".ms-MessageBanner-clipper\");\n  clipper.innerHTML = \"Something went wrong: \" + JSON.stringify(msg);\n  messageBanner.style.display = \"none\";\n  // print the error in the console too\n  console.log(msg);\n}\n\nfunction debugCB(msg) {\n  // console.debug(msg);\n}\n\nfunction disableSpinner() {\n  document.getElementById(\"app-body\").style.display = \"\";\n  document.getElementById(\"spinner\").style.display = \"none\";\n}\n\nfunction toggleSpinner() {\n  if (document.getElementById(\"spinner\").style.display === \"none\") {\n    document.getElementById(\"app-body\").style.display = \"none\";\n    document.getElementById(\"spinner\").style.display = \"\";\n  } else {\n    disableSpinner();\n  }\n}\n\nfunction updateDataMapList(dataMap) {\n  // remove old results\n  document.getElementById(\"results\").innerHTML = \"\";\n\n  dataMap.forEach((dataItem, idx) => {\n    easyEws.getMailItem(dataItem.id,\n      function(orig) {\n        var symbol = \"CheckMark\";\n        if (dataItem.result == NEGATIVEMATCH) {\n          symbol = \"AlertSolid\";\n        }\n        var item = '<li class=\"ms-ListItem\">' +\n          '  <i class=\"ms-Icon ms-Icon--' + symbol + ' ms-font-xl\"></i>' +\n          '  <span class=\"ms-font-m\">' +\n          '    <u>' + stripHTML(orig.Subject()) + '</u>' +\n          '    was marked as harmless.' +\n          '  </span>' +\n          '</li>';\n        document.getElementById(\"results\").innerHTML = document.getElementById(\"results\").innerHTML + item;\n      },\n      (error) => errorCB(error),\n      (debug) => debugCB(debug),\n    );\n\n    if (idx >= (dataMap.length - 1)) {\n      document.getElementById(\"welcome-features\").style.display = \"none\";\n      document.getElementById(\"results\").style.display = \"\";\n    }\n  });\n}\n\nfunction sendSuspiciousMessage() {\n  var item = Office.context.mailbox.item;\n  var itemId = item.itemId;\n  // collect and send current item via ews\n  easyEws.getMailItemMimeContent(itemId, (mimeContent) => {\n    easyEws.sendPlainTextEmailWithAttachment(\n      defaultSubject,\n      \"{%%\" + itemId + \"%%}\",\n      toAddress,\n      \"Suspicious_Email.msg\",\n      mimeContent,\n      function (result) { console.log(result); },\n      (error) => errorCB(error),\n      (debug) => debugCB(debug),\n    );\n  }, (error) => errorCB(error), (debug) => debugCB(debug));\n}\n\nfunction moveItemToDeleted(itemId) {\n  easyEws.moveItem(itemId, \"deleteditems\",\n    function (result) { /*console.debug(result);*/ },\n    (error) => errorCB(error),\n    (debug) => debugCB(debug),\n  );\n}\n\nfunction foundResults(itemId, item) {\n  toggleSpinner();\n\n  console.debug(\"Found result!\");\n  var body = item.Body();\n  if (body.search(positiveMatch) <= 0) {\n    result = NEGATIVEMATCH;\n  } else {\n    result = POSITIVEMATCH;\n  }\n  document.getElementById(\"result\").innerHTML = \"<b>Result:</b> \" + result;\n  // clean up\n  moveItemToDeleted(itemId);\n}\n\nfunction searchFolderForResults(folder, query, resultCallback) {\n  easyEws.getFolderId(folder,\n    function(inboxId) {\n      easyEws.getFolderItemIds(\n        inboxId,\n        function(inboxItems) {\n          inboxItems.forEach((itemId, idx) => {\n            easyEws.getMailItem(\n              itemId,\n              (item) => resultCallback(itemId, item, idx, (inboxItems.length - 1)),\n              (error) => errorCB(error),\n              (debug) => debugCB(debug),\n            );\n          });\n        },\n        (error) => errorCB(error),\n        (debug) => debugCB(debug),\n        {\n          maxEntries: 10,\n          queryString: query,\n        },\n      );\n    },\n    (error) => errorCB(error),\n    (debug) => debugCB(debug),\n  );\n}\n\nfunction searchLoop() {\n  setTimeout(() => {\n    console.debug(\"Searching for results..\");\n    searchFolderForResults(\n      \"inbox\",\n      'from:\"' + toAddress + '\" AND received:today',\n      foundResults,\n    );\n    if (!timeout && result !== POSITIVEMATCH && result !== NEGATIVEMATCH) {\n      searchLoop();\n    }\n  }, 10000);\n\n  if (!timeoutSet) {\n    // set timeout after five minutes\n    setTimeout(() => {\n      if (result === POSITIVEMATCH || result === NEGATIVEMATCH) {\n        return;\n      }\n\n      console.debug(\"Timeout!\");\n      timeout = true;\n      toggleSpinner();\n    }, 360000);\n    timeoutSet = true;\n  }\n}\n\nfunction update() {\n  toggleSpinner();\n\n  // remove old elements\n  dataMap = [];\n  // clean up inbox with old reports\n  searchFolderForResults(\n    \"inbox\",\n    'from:\"' + toAddress + '\" AND received:today',\n    itemId => moveItemToDeleted(itemId),\n  );\n\n  searchFolderForResults(\"sentitems\", 'to:\"' + toAddress + '\" AND received:today', (itemId, item, position, last) => {\n    var body = item.Body();\n    var match = body.match(itemIdRegex);\n\n    if (match && match.length > 0) {\n      dataMap.push({\n        id: match[1], // should be itemId of mail-to-be-checked\n        result: NOTFOUNDYET,\n      });\n    }\n\n    if (position >= last) {\n      searchFolderForResults(\"deleteditems\", 'from:\"' + toAddress + '\" AND received:today', (sItemId, sItem, position, last) => {\n        var sBody = sItem.Body();\n        var sMatch = sBody.match(itemIdRegex);\n\n        if (sMatch && sMatch.length > 0) {\n          dataMap.forEach((dataItem, idx) => {\n            if (dataItem.id === sMatch[1]) {\n              if (sBody.search(positiveMatch) <= 0) {\n                dataMap[idx].result = NEGATIVEMATCH;\n              } else {\n                dataMap[idx].result = POSITIVEMATCH;\n              }\n            }\n          });\n        }\n\n        if (position >= last) {\n          updateDataMapList(dataMap);\n          toggleSpinner();\n        }\n      });\n    }\n  });\n}\n\nexport async function run() {\n  toggleSpinner();\n\n  var timeout = false;\n  result = NOTFOUNDYET;\n\n  // send suspicious mail to badmail\n  sendSuspiciousMessage();\n  // search until timout for results\n  searchLoop();\n}\n"],"names":["positiveMatch","itemIdRegex","timeout","timeoutSet","result","dataMap","stripHTML","html","div","document","createElement","innerHTML","textContent","innerText","errorCB","msg","disableSpinner","messageBanner","getElementById","querySelector","JSON","stringify","style","display","console","log","toggleSpinner","sendSuspiciousMessage","itemId","Office","context","mailbox","item","easyEws","getMailItemMimeContent","mimeContent","sendPlainTextEmailWithAttachment","error","debug","moveItemToDeleted","moveItem","foundResults","body","Body","search","searchFolderForResults","folder","query","resultCallback","getFolderId","inboxId","getFolderItemIds","inboxItems","forEach","idx","getMailItem","length","maxEntries","queryString","searchLoop","setTimeout","update","position","last","match","push","id","sItemId","sItem","sBody","sMatch","dataItem","orig","symbol","Subject","updateDataMapList","run","onReady","info","host","HostType","Outlook","subject","onclick","spinnerElements","querySelectorAll","i","fabric","addEventListener"],"sourceRoot":""}