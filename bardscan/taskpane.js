!function(){"use strict";function e(e,n,t,o,i,c,u){try{var r=e[c](u),s=r.value}catch(e){return void t(e)}r.done?n(s):Promise.resolve(s).then(o,i)}function n(n){return function(){var t=this,o=arguments;return new Promise((function(i,c){var u=n.apply(t,o);function r(n){e(u,i,c,r,s,"next",n)}function s(n){e(u,i,c,r,s,"throw",n)}r(void 0)}))}}var t="no suspicious activity has been detected",o=/\{\%\%(.+)\%\%\}/,i=!1,c=!1,u=0,r=[];function s(e){var n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""}function l(e){a();var n=document.getElementById("messageBanner");n.querySelector(".ms-MessageBanner-clipper").innerHTML="Something went wrong: "+JSON.stringify(e),n.style.display="none",console.log(e)}function a(){document.getElementById("app-body").style.display="",document.getElementById("spinner").style.display="none"}function m(){"none"===document.getElementById("spinner").style.display?(document.getElementById("app-body").style.display="none",document.getElementById("spinner").style.display=""):a()}function d(){var e=Office.context.mailbox.item.itemId;easyEws.getMailItemMimeContent(e,(function(n){easyEws.sendPlainTextEmailWithAttachment("Suspicious Email Alert","{%%"+e+"%%}","bad@mail.com","Suspicious_Email.msg",n,(function(e){console.log(e)}),(function(e){return l(e)}),(function(e){}))}),(function(e){return l(e)}),(function(e){}))}function f(e){easyEws.moveItem(e,"deleteditems",(function(e){}),(function(e){return l(e)}),(function(e){}))}function y(e,n){m(),console.debug("Found result!");var o=n.Body();u=o.search(t)<=0?2:1,document.getElementById("result").innerHTML="<b>Result:</b> "+u,f(e)}function g(e,n,t){easyEws.getFolderId(e,(function(e){easyEws.getFolderItemIds(e,(function(e){e.forEach((function(n,o){easyEws.getMailItem(n,(function(i){return t(n,i,o,e.length-1)}),(function(e){return l(e)}),(function(e){}))}))}),(function(e){return l(e)}),(function(e){}),{maxEntries:10,queryString:n})}),(function(e){return l(e)}),(function(e){}))}function p(){setTimeout((function(){console.debug("Searching for results.."),g("inbox",'from:"bad@mail.com" AND received:today',y),i||1===u||2===u||p()}),1e4),c||(setTimeout((function(){1!==u&&2!==u&&(console.debug("Timeout!"),i=!0,m())}),36e4),c=!0)}function E(){m(),r=[],g("inbox",'from:"bad@mail.com" AND received:today',(function(e){return f(e)})),g("sentitems",'to:"bad@mail.com" AND received:today',(function(e,n,i,c){var u=n.Body().match(o);u&&u.length>0&&r.push({id:u[1],result:0}),i>=c&&g("deleteditems",'from:"bad@mail.com" AND received:today',(function(e,n,i,c){var u=n.Body(),a=u.match(o);a&&a.length>0&&r.forEach((function(e,n){e.id===a[1]&&(u.search(t)<=0?r[n].result=2:r[n].result=1)})),i>=c&&(function(e){document.getElementById("results").innerHTML="",e.forEach((function(n,t){easyEws.getMailItem(n.id,(function(e){var t="CheckMark";2==n.result&&(t="AlertSolid");var o='<li class="ms-ListItem">  <i class="ms-Icon ms-Icon--'+t+' ms-font-xl"></i>  <span class="ms-font-m">    <u>'+s(e.Subject())+"</u>    was marked as harmless.  </span></li>";document.getElementById("results").innerHTML=document.getElementById("results").innerHTML+o}),(function(e){return l(e)}),(function(e){})),t>=e.length-1&&(document.getElementById("welcome-features").style.display="none",document.getElementById("results").style.display="")}))}(r),m())}))}))}function h(){return v.apply(this,arguments)}function v(){return(v=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m(),u=0,d(),p();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Office.onReady((function(e){if(e.host===Office.HostType.Outlook){document.getElementById("mail-subject").innerHTML=s(Office.context.mailbox.item.subject),document.getElementById("app-body").style.display="flex",document.getElementById("run").onclick=h,document.getElementById("update").onclick=E;for(var n=document.querySelectorAll(".ms-Spinner"),t=0;t<n.length;t++)new fabric.Spinner(n[t]);var o=document.getElementById("messageBanner");o.querySelector(".ms-MessageBanner-close").addEventListener("click",(function(){setTimeout((function(){o.style.display="none"}),500)})),g("inbox",'from:"bad@mail.com" AND received:today',(function(e){return f(e)}))}}))}();
//# sourceMappingURL=taskpane.js.map